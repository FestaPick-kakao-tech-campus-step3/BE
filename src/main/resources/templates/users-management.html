<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>회원 관리</title>
    <style>
        :root { --blue:#2563eb; --blue-dark:#1e40af; --gray:#e5e7eb; --text:#111827; }
        *{box-sizing:border-box}
        body{margin:0;background:#fff;font-family:system-ui,-apple-system,sans-serif;color:#333;padding:24px}
        h1{margin-bottom:18px;font-size:1.6rem;color:var(--text)}
        .toolbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap}
        .btn{appearance:none;border:0;cursor:pointer;background:var(--blue);color:#fff;padding:10px 14px;border-radius:8px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:6px;white-space: nowrap;}
        .btn:hover{background:var(--blue-dark)}
        .btn.outline{background:#fff;color:var(--blue);border:1px solid var(--blue)}
        table{width:100%;border-collapse:collapse;border:1px solid var(--gray);border-radius:12px;overflow:hidden}
        th,td{padding:12px 12px;border-bottom:1px solid var(--gray);text-align:left}
        thead th{background:#f9fafb;font-weight:700}
        .row-actions{display:flex;gap:8px;flex-wrap:wrap}
        .muted{color:#6b7280}
        .right{display:flex;justify-content:flex-end}
        .topbar {
            position: absolute;
            top: 16px;
            right: 24px;
        }
    </style>
</head>
<body>

<h1>회원 관리</h1>
<div class="topbar">
    <div th:replace="~{fragments/logout :: logout(@{/admin/logout}, '로그아웃')}"></div>
</div>
<div class="toolbar">
    <!-- 우측 상단 로그인 버튼 -->
    <div class="muted" th:text="|총 ${page.totalElements}명|">총 0명</div>
</div>

<table>
    <thead>
    <tr>
        <th style="width:90px">ID</th>
        <th style="width:200px">Identifier</th>
        <th>이메일</th>
        <th>닉네임</th>
        <th style="width:180px">권한</th>
        <th style="width:300px">관리</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${page.content}">
        <td th:text="${user.id}">1</td>
        <td th:text="${user.identifier}">abcd-1234</td>
        <td th:text="${user.email}">user@example.com</td>
        <td th:text="${user.username}">홍길동</td>

        <!-- 권한 변경 -->
        <td>
            <form th:action="@{|/admin/users/${user.id}/role|}" method="post" style="display:flex; gap:8px; align-items:center">
                <input type="hidden" name="page" th:value="${page.number}"/>
                <input type="hidden" name="sort" th:value="${sort}"/>
                <select name="role" th:value="${user.role}">
                    <option th:selected="${user.role == 'ADMIN'}" value="ADMIN">ADMIN</option>
                    <option th:selected="${user.role == 'USER'}" value="USER">USER</option>
                    <option th:selected="${user.role == 'FESTIVAL_MANAGER'}" value="FESTIVAL_MANAGER">지역축제 관리자</option>
                </select>
                <button class="btn" type="submit">변경</button>
            </form>
        </td>

        <!-- 탈퇴 -->
        <td>
            <form th:action="@{|/admin/users/${user.id}|}" method="post" class="row-actions"
                  onsubmit="return confirm('정말로 탈퇴시키겠습니까?');">
                <input type="hidden" name="_method" value="DELETE"/>
                <input type="hidden" name="page" th:value="${page.number}"/>
                <input type="hidden" name="sort" th:value="${sort}"/>
                <button class="btn outline" type="submit">회원 탈퇴</button>
            </form>
        </td>
    </tr>
    <tr th:if="${#lists.isEmpty(page.content)}">
        <td colspan="6" class="muted">결과가 없습니다.</td>
    </tr>
    </tbody>
</table>

<!-- 페이지 네이션 -->
<div style="margin-top:14px" class="right" th:if="${page.totalPages > 1}">
    <div style="display:flex; gap:8px; flex-wrap:wrap">
        <a class="btn outline"
           th:href="@{/admin/users(page=${page.number-1},sort=${sort})}"
           th:if="${page.number > 0}">이전</a>

        <a class="btn outline"
           th:each="p : ${#numbers.sequence(0, page.totalPages - 1)}"
           th:href="@{/admin/users(page=${p}, sort=${sort})}"
           th:text="${p + 1}"
           th:classappend="${p == page.number} ? ' btn' : ' btn outline'"></a>

        <a class="btn outline"
           th:href="@{/admin/users(page=${page.number+1},sort=${sort})}"
           th:if="${page.number + 1 < page.totalPages}">다음</a>
    </div>
</div>

</body>
</html>
